#!/bin/bash

# --------------------------
# æ“·å– remote list
# --------------------------
extract_list() {
    local input="$1"
    input="${input//[()]/}"     # å»æ‰æ‹¬è™Ÿ
    IFS=',' read -ra result <<< "$input"
    echo "${result[@]}"
}

# --------------------------
# ä¸»é‚è¼¯
# --------------------------

# é è¨­å€¼
remotes=()
branches=()

# å–å‡ºç¬¬ä¸€å€‹åƒæ•¸ï¼šæ‡‰è©²æ˜¯ (remote1,remote2)
if [[ "$1" =~ ^\(.+\)$ ]]; then
    remotes=($(extract_list "$1"))
    shift
else
    echo "âŒ è«‹ä½¿ç”¨ (remote1,remote2) çš„æ ¼å¼ä½œç‚ºç¬¬ä¸€å€‹åƒæ•¸"
    exit 1
fi

# å‰©ä¸‹çš„åƒæ•¸æ˜¯ branchesï¼ˆè‹¥ç‚ºç©ºå°±æŠ“ç•¶å‰ branchï¼‰
if [[ $# -gt 0 ]]; then
    branches=("$@")
else
    current_branch=$(git symbolic-ref --short HEAD 2>/dev/null)
    if [[ -z "$current_branch" ]]; then
        echo "âŒ ç„¡æ³•åµæ¸¬ç›®å‰æ‰€åœ¨ branchï¼Œè«‹æŒ‡å®š"
        exit 1
    fi
    branches=("$current_branch")
fi

# --------------------------
# åŸ·è¡Œ git push
# --------------------------
for remote in "${remotes[@]}"; do
    for branch in "${branches[@]}"; do
        echo "ğŸš€ Pushing to '$remote' (branch: '$branch')..."
        git push "$remote" "$branch"
        if [[ $? -ne 0 ]]; then
            echo "âŒ Push to '$remote' å¤±æ•—"
        fi
    done
done
